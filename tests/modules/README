# Module Tests

This directory contains tests for third-party UnrealIRCd modules.

## Chess Module Tests

Tests for the chess module (third/chess):

- **chess_basic** - Basic functionality (request, accept, moves, resign, observer mode)
- **chess_moves** - Move validation (all piece types, castling, captures)
- **chess_games_list** - Games listing command

### Running Chess Tests

Run all chess tests:
```bash
./run -services none -boot tests/modules/chess_*
```

Run specific test:
```bash
./run -services none -boot tests/modules/chess_basic
```

### Prerequisites

1. UnrealIRCd must be compiled with chess module:
   ```bash
   cd ~/unrealircd/src/modules/third/chess
   make clean
   cd ~/unrealircd
   make install
   ```

2. Chess module must be loaded in unrealircd.conf:
   ```
   loadmodule "third/chess";
   ```

### Test Coverage

- ✅ Game request and acceptance
- ✅ Game decline
- ✅ Move validation (valid/invalid)
- ✅ Turn enforcement
- ✅ Piece movements (pawn, knight, bishop, etc.)
- ✅ Special moves (castling, captures)
- ✅ Check notification
- ✅ Board display
- ✅ Chess clock
- ✅ Game resignation
- ✅ Observer mode
- ✅ Games listing
- ✅ Multiple simultaneous games

### Expected Behavior

**Game Request:**
- Numeric 900 sent to target player
- Confirmation notice to requester

**Game Accept:**
- Both players join auto-created channel (#chess-player1-player2)
- Numeric 901 (game start) sent
- User mode +c set on both players
- Channel mode +C set on game channel

**Moves:**
- Numeric 920 (move notification) on valid move
- Numeric 941 (invalid move) on invalid move
- Numeric 942 (not your turn) when wrong player tries to move
- Numeric 913 (check) when king is in check

**Game End:**
- Numeric 902 (game end) sent
- User mode +c removed from both players
- Game logged to PGN file

### Debugging Failed Tests

Check server logs:
```bash
tail -f ~/unrealircd/logs/ircd.log
```

Check chess game logs:
```bash
ls -l ~/unrealircd/chess-logs/
```

Run test with verbose output:
```bash
./run -services none -boot -debug tests/modules/chess_basic
```

